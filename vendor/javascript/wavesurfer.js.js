function t(r,g,v,b){return new(v||(v=Promise))((function(y,C){function o(r){try{h(b.next(r))}catch(r){C(r)}}function a(r){try{h(b.throw(r))}catch(r){C(r)}}function h(r){var g;r.done?y(r.value):(g=r.value,g instanceof v?g:new v((function(r){r(g)}))).then(o,a)}h((b=b.apply(r,g||[])).next())}))}class e{constructor(){this.listeners={}}on(r,g,v){if(this.listeners[r]||(this.listeners[r]=new Set),this.listeners[r].add(g),null==v?void 0:v.once){const i=()=>{this.un(r,i),this.un(r,g)};return this.on(r,i),i}return()=>this.un(r,g)}un(r,g){var v;null===(v=this.listeners[r])||void 0===v||v.delete(g)}once(r,g){return this.on(r,g,{once:!0})}unAll(){this.listeners={}}emit(r,...g){this.listeners[r]&&this.listeners[r].forEach((r=>r(...g)))}}const r={decode:function(r,g){return t(this,void 0,void 0,(function*(){const v=new AudioContext({sampleRate:g});return v.decodeAudioData(r).finally((()=>v.close()))}))},createBuffer:function(r,g){return"number"==typeof r[0]&&(r=[r]),function(r){const g=r[0];if(g.some((r=>r>1||r<-1))){const v=g.length;let b=0;for(let r=0;r<v;r++){const v=Math.abs(g[r]);v>b&&(b=v)}for(const g of r)for(let r=0;r<v;r++)g[r]/=b}}(r),{duration:g,length:r[0].length,sampleRate:r[0].length/g,numberOfChannels:r.length,getChannelData:g=>null==r?void 0:r[g],copyFromChannel:AudioBuffer.prototype.copyFromChannel,copyToChannel:AudioBuffer.prototype.copyToChannel}}};function s(r,g){const v=g.xmlns?document.createElementNS(g.xmlns,r):document.createElement(r);for(const[r,b]of Object.entries(g))if("children"===r)for(const[r,b]of Object.entries(g))"string"==typeof b?v.appendChild(document.createTextNode(b)):v.appendChild(s(r,b));else"style"===r?Object.assign(v.style,b):"textContent"===r?v.textContent=b:v.setAttribute(r,b.toString());return v}function n(r,g,v){const b=s(r,g||{});return null==v||v.appendChild(b),b}var g=Object.freeze({__proto__:null,createElement:n,default:n});const v={fetchBlob:function(r,g,v){return t(this,void 0,void 0,(function*(){const b=yield fetch(r,v);if(b.status>=400)throw new Error(`Failed to fetch ${r}: ${b.status} (${b.statusText})`);return function(r,g){t(this,void 0,void 0,(function*(){if(!r.body||!r.headers)return;const v=r.body.getReader(),b=Number(r.headers.get("Content-Length"))||0;let y=0;const o=r=>t(this,void 0,void 0,(function*(){y+=(null==r?void 0:r.length)||0;const v=Math.round(y/b*100);g(v)})),a=()=>t(this,void 0,void 0,(function*(){let r;try{r=yield v.read()}catch(r){return}r.done||(o(r.value),yield a())}));a()}))}(b.clone(),g),b.blob()}))}};class a extends e{constructor(r){super(),this.isExternalMedia=!1,r.media?(this.media=r.media,this.isExternalMedia=!0):this.media=document.createElement("audio"),r.mediaControls&&(this.media.controls=!0),r.autoplay&&(this.media.autoplay=!0),null!=r.playbackRate&&this.onceMediaEvent("canplay",(()=>{null!=r.playbackRate&&(this.media.playbackRate=r.playbackRate)}))}onMediaEvent(r,g,v){return this.media.addEventListener(r,g,v),()=>this.media.removeEventListener(r,g)}onceMediaEvent(r,g){return this.onMediaEvent(r,g,{once:!0})}getSrc(){return this.media.currentSrc||this.media.src||""}revokeSrc(){const r=this.getSrc();r.startsWith("blob:")&&URL.revokeObjectURL(r)}canPlayType(r){return""!==this.media.canPlayType(r)}setSrc(r,g){if(this.getSrc()===r)return;this.revokeSrc();const v=g instanceof Blob&&this.canPlayType(g.type)?URL.createObjectURL(g):r;this.media.src=v}destroy(){this.media.pause(),this.isExternalMedia||(this.media.remove(),this.revokeSrc(),this.media.src="",this.media.load())}setMediaElement(r){this.media=r}play(){return t(this,void 0,void 0,(function*(){if(this.media.src)return this.media.play()}))}pause(){this.media.pause()}isPlaying(){return!this.media.paused&&!this.media.ended}setTime(r){this.media.currentTime=r}getDuration(){return this.media.duration}getCurrentTime(){return this.media.currentTime}getVolume(){return this.media.volume}setVolume(r){this.media.volume=r}getMuted(){return this.media.muted}setMuted(r){this.media.muted=r}getPlaybackRate(){return this.media.playbackRate}isSeeking(){return this.media.seeking}setPlaybackRate(r,g){null!=g&&(this.media.preservesPitch=g),this.media.playbackRate=r}getMediaElement(){return this.media}setSinkId(r){return this.media.setSinkId(r)}}class h extends e{constructor(r,g){super(),this.timeouts=[],this.isScrollable=!1,this.audioData=null,this.resizeObserver=null,this.lastContainerWidth=0,this.isDragging=!1,this.options=r;const v=this.parentFromOptionsContainer(r.container);this.parent=v;const[b,y]=this.initHtml();v.appendChild(b),this.container=b,this.scrollContainer=y.querySelector(".scroll"),this.wrapper=y.querySelector(".wrapper"),this.canvasWrapper=y.querySelector(".canvases"),this.progressWrapper=y.querySelector(".progress"),this.cursor=y.querySelector(".cursor"),g&&y.appendChild(g),this.initEvents()}parentFromOptionsContainer(r){let g;if("string"==typeof r?g=document.querySelector(r):r instanceof HTMLElement&&(g=r),!g)throw new Error("Container not found");return g}initEvents(){const t=r=>{const g=this.wrapper.getBoundingClientRect(),v=r.clientX-g.left,b=r.clientX-g.left;return[v/g.width,b/g.height]};this.wrapper.addEventListener("click",(r=>{const[g,v]=t(r);this.emit("click",g,v)})),this.wrapper.addEventListener("dblclick",(r=>{const[g,v]=t(r);this.emit("dblclick",g,v)})),this.options.dragToSeek&&this.initDrag(),this.scrollContainer.addEventListener("scroll",(()=>{const{scrollLeft:r,scrollWidth:g,clientWidth:v}=this.scrollContainer,b=r/g,y=(r+v)/g;this.emit("scroll",b,y)}));const r=this.createDelay(100);this.resizeObserver=new ResizeObserver((()=>{r().then((()=>this.onContainerResize())).catch((()=>{}))})),this.resizeObserver.observe(this.scrollContainer)}onContainerResize(){const r=this.parent.clientWidth;r===this.lastContainerWidth&&"auto"!==this.options.height||(this.lastContainerWidth=r,this.reRender())}initDrag(){!function(r,g,v,b,y=3,C=0){if(!r)return()=>{};let o=()=>{};const a=w=>{if(w.button!==C)return;w.preventDefault(),w.stopPropagation();let E=w.clientX,S=w.clientY,x=!1;const c=b=>{b.preventDefault(),b.stopPropagation();const C=b.clientX,w=b.clientY,k=C-E,M=w-S;if(x||Math.abs(k)>y||Math.abs(M)>y){const b=r.getBoundingClientRect(),{left:y,top:D}=b;x||(null==v||v(E-y,S-D),x=!0),g(k,M,C-y,w-D),E=C,S=w}},u=()=>{x&&(null==b||b()),o()},p=r=>{r.relatedTarget&&r.relatedTarget!==document.documentElement||u()},m=r=>{x&&(r.stopPropagation(),r.preventDefault())},f=r=>{x&&r.preventDefault()};document.addEventListener("pointermove",c),document.addEventListener("pointerup",u),document.addEventListener("pointerout",p),document.addEventListener("pointercancel",p),document.addEventListener("touchmove",f,{passive:!1}),document.addEventListener("click",m,{capture:!0}),o=()=>{document.removeEventListener("pointermove",c),document.removeEventListener("pointerup",u),document.removeEventListener("pointerout",p),document.removeEventListener("pointercancel",p),document.removeEventListener("touchmove",f),setTimeout((()=>{document.removeEventListener("click",m,{capture:!0})}),10)}};r.addEventListener("pointerdown",a)}(this.wrapper,((r,g,v)=>{this.emit("drag",Math.max(0,Math.min(1,v/this.wrapper.getBoundingClientRect().width)))}),(()=>this.isDragging=!0),(()=>this.isDragging=!1))}getHeight(r){return null==r?128:isNaN(Number(r))?"auto"===r&&this.parent.clientHeight||128:Number(r)}initHtml(){const r=document.createElement("div"),g=r.attachShadow({mode:"open"});return g.innerHTML=`\n      <style>\n        :host {\n          user-select: none;\n          min-width: 1px;\n        }\n        :host audio {\n          display: block;\n          width: 100%;\n        }\n        :host .scroll {\n          overflow-x: auto;\n          overflow-y: hidden;\n          width: 100%;\n          position: relative;\n        }\n        :host .noScrollbar {\n          scrollbar-color: transparent;\n          scrollbar-width: none;\n        }\n        :host .noScrollbar::-webkit-scrollbar {\n          display: none;\n          -webkit-appearance: none;\n        }\n        :host .wrapper {\n          position: relative;\n          overflow: visible;\n          z-index: 2;\n        }\n        :host .canvases {\n          min-height: ${this.getHeight(this.options.height)}px;\n        }\n        :host .canvases > div {\n          position: relative;\n        }\n        :host canvas {\n          display: block;\n          position: absolute;\n          top: 0;\n          image-rendering: pixelated;\n        }\n        :host .progress {\n          pointer-events: none;\n          position: absolute;\n          z-index: 2;\n          top: 0;\n          left: 0;\n          width: 0;\n          height: 100%;\n          overflow: hidden;\n        }\n        :host .progress > div {\n          position: relative;\n        }\n        :host .cursor {\n          pointer-events: none;\n          position: absolute;\n          z-index: 5;\n          top: 0;\n          left: 0;\n          height: 100%;\n          border-radius: 2px;\n        }\n      </style>\n\n      <div class="scroll" part="scroll">\n        <div class="wrapper" part="wrapper">\n          <div class="canvases"></div>\n          <div class="progress" part="progress"></div>\n          <div class="cursor" part="cursor"></div>\n        </div>\n      </div>\n    `,[r,g]}setOptions(r){if(this.options.container!==r.container){const g=this.parentFromOptionsContainer(r.container);g.appendChild(this.container),this.parent=g}r.dragToSeek&&!this.options.dragToSeek&&this.initDrag(),this.options=r,this.reRender()}getWrapper(){return this.wrapper}getScroll(){return this.scrollContainer.scrollLeft}destroy(){var r;this.container.remove(),null===(r=this.resizeObserver)||void 0===r||r.disconnect()}createDelay(r=10){let g,v;const s=()=>{g&&clearTimeout(g),v&&v()};return this.timeouts.push(s),()=>new Promise(((b,y)=>{s(),v=y,g=setTimeout((()=>{g=void 0,v=void 0,b()}),r)}))}convertColorValues(r){if(!Array.isArray(r))return r||"";if(r.length<2)return r[0]||"";const g=document.createElement("canvas"),v=g.getContext("2d"),b=g.height*(window.devicePixelRatio||1),y=v.createLinearGradient(0,0,0,b),C=1/(r.length-1);return r.forEach(((r,g)=>{const v=g*C;y.addColorStop(v,r)})),y}renderBarWaveform(r,g,v,b){const y=r[0],C=r[1]||r[0],w=y.length,{width:E,height:S}=v.canvas,x=S/2,k=window.devicePixelRatio||1,M=g.barWidth?g.barWidth*k:1,D=g.barGap?g.barGap*k:g.barWidth?M/2:0,P=g.barRadius||0,T=E/(M+D)/w,R=P&&"roundRect"in v?"roundRect":"rect";v.beginPath();let L=0,W=0,N=0;for(let r=0;r<=w;r++){const w=Math.round(r*T);if(w>L){const r=Math.round(W*x*b),y=r+Math.round(N*x*b)||1;let C=x-r;"top"===g.barAlign?C=0:"bottom"===g.barAlign&&(C=S-y),v[R](L*(M+D),C,M,y,P),L=w,W=0,N=0}const E=Math.abs(y[r]||0),k=Math.abs(C[r]||0);E>W&&(W=E),k>N&&(N=k)}v.fill(),v.closePath()}renderLineWaveform(r,g,v,b){const n=g=>{const y=r[g]||r[0],C=y.length,{height:w}=v.canvas,E=w/2,S=v.canvas.width/C;v.moveTo(0,E);let x=0,k=0;for(let r=0;r<=C;r++){const C=Math.round(r*S);if(C>x){const r=E+(Math.round(k*E*b)||1)*(0===g?-1:1);v.lineTo(x,r),x=C,k=0}const w=Math.abs(y[r]||0);w>k&&(k=w)}v.lineTo(x,E)};v.beginPath(),n(0),n(1),v.fill(),v.closePath()}renderWaveform(r,g,v){if(v.fillStyle=this.convertColorValues(g.waveColor),g.renderFunction)return void g.renderFunction(r,v);let b=g.barHeight||1;if(g.normalize){const g=Array.from(r[0]).reduce(((r,g)=>Math.max(r,Math.abs(g))),0);b=g?1/g:1}g.barWidth||g.barGap||g.barAlign?this.renderBarWaveform(r,g,v,b):this.renderLineWaveform(r,g,v,b)}renderSingleCanvas(r,g,v,b,y,C,w,E){const S=window.devicePixelRatio||1,x=document.createElement("canvas"),k=r[0].length;x.width=Math.round(v*(C-y)/k),x.height=b*S,x.style.width=`${Math.floor(x.width/S)}px`,x.style.height=`${b}px`,x.style.left=`${Math.floor(y*v/S/k)}px`,w.appendChild(x);const M=x.getContext("2d");if(this.renderWaveform(r.map((r=>r.slice(y,C))),g,M),x.width>0&&x.height>0){const r=x.cloneNode(),v=r.getContext("2d");v.drawImage(x,0,0),v.globalCompositeOperation="source-in",v.fillStyle=this.convertColorValues(g.progressColor),v.fillRect(0,0,x.width,x.height),E.appendChild(r)}}renderChannel(r,g,v){return t(this,void 0,void 0,(function*(){const b=document.createElement("div"),y=this.getHeight(g.height);b.style.height=`${y}px`,this.canvasWrapper.style.minHeight=`${y}px`,this.canvasWrapper.appendChild(b);const C=b.cloneNode();this.progressWrapper.appendChild(C);const w=r[0].length,l=(E,S)=>{this.renderSingleCanvas(r,g,v,y,Math.max(0,E),Math.min(S,w),b,C)};if(!this.isScrollable)return void l(0,w);const{scrollLeft:E,scrollWidth:S,clientWidth:x}=this.scrollContainer,k=w/S;let M=Math.min(h.MAX_CANVAS_WIDTH,x);if(g.barWidth||g.barGap){const r=g.barWidth||.5,v=r+(g.barGap||r/2);M%v!=0&&(M=Math.floor(M/v)*v)}const D=Math.floor(Math.abs(E)*k),P=Math.floor(D+M*k),T=P-D;T<=0||(l(D,P),yield Promise.all([(()=>t(this,void 0,void 0,(function*(){if(0===D)return;const r=this.createDelay();for(let g=D;g>=0;g-=T)yield r(),l(Math.max(0,g-T),g)})))(),(()=>t(this,void 0,void 0,(function*(){if(P===w)return;const r=this.createDelay();for(let g=P;g<w;g+=T)yield r(),l(g,Math.min(w,g+T))})))()]))}))}render(r){return t(this,void 0,void 0,(function*(){this.timeouts.forEach((r=>r())),this.timeouts=[],this.canvasWrapper.innerHTML="",this.progressWrapper.innerHTML="",null!=this.options.width&&(this.scrollContainer.style.width="number"==typeof this.options.width?`${this.options.width}px`:this.options.width);const g=window.devicePixelRatio||1,v=this.scrollContainer.clientWidth,b=Math.ceil(r.duration*(this.options.minPxPerSec||0));this.isScrollable=b>v;const y=this.options.fillParent&&!this.isScrollable,C=(y?v:b)*g;this.wrapper.style.width=y?"100%":`${b}px`,this.scrollContainer.style.overflowX=this.isScrollable?"auto":"hidden",this.scrollContainer.classList.toggle("noScrollbar",!!this.options.hideScrollbar),this.cursor.style.backgroundColor=`${this.options.cursorColor||this.options.progressColor}`,this.cursor.style.width=`${this.options.cursorWidth}px`,this.audioData=r,this.emit("render");try{if(this.options.splitChannels)yield Promise.all(Array.from({length:r.numberOfChannels}).map(((g,v)=>{var b;const y=Object.assign(Object.assign({},this.options),null===(b=this.options.splitChannels)||void 0===b?void 0:b[v]);return this.renderChannel([r.getChannelData(v)],y,C)})));else{const g=[r.getChannelData(0)];r.numberOfChannels>1&&g.push(r.getChannelData(1)),yield this.renderChannel(g,this.options,C)}}catch(g){return}this.emit("rendered")}))}reRender(){if(!this.audioData)return;const{scrollWidth:r}=this.scrollContainer,{right:g}=this.progressWrapper.getBoundingClientRect();if(this.render(this.audioData),this.isScrollable&&r!==this.scrollContainer.scrollWidth){const{right:r}=this.progressWrapper.getBoundingClientRect();let v=r-g;v*=2,v=v<0?Math.floor(v):Math.ceil(v),v/=2,this.scrollContainer.scrollLeft+=v}}zoom(r){this.options.minPxPerSec=r,this.reRender()}scrollIntoView(r,g=!1){const{scrollLeft:v,scrollWidth:b,clientWidth:y}=this.scrollContainer,C=r*b,w=v,E=v+y,S=y/2;if(this.isDragging){const r=30;C+r>E?this.scrollContainer.scrollLeft+=r:C-r<w&&(this.scrollContainer.scrollLeft-=r)}else{(C<w||C>E)&&(this.scrollContainer.scrollLeft=C-(this.options.autoCenter?S:0));const r=C-v-S;g&&this.options.autoCenter&&r>0&&(this.scrollContainer.scrollLeft+=Math.min(r,10))}{const r=this.scrollContainer.scrollLeft,g=r/b,v=(r+y)/b;this.emit("scroll",g,v)}}renderProgress(r,g){if(isNaN(r))return;const v=100*r;this.canvasWrapper.style.clipPath=`polygon(${v}% 0, 100% 0, 100% 100%, ${v}% 100%)`,this.progressWrapper.style.width=`${v}%`,this.cursor.style.left=`${v}%`,this.cursor.style.transform=`translateX(-${100===Math.round(v)?this.options.cursorWidth:0}px)`,this.isScrollable&&this.options.autoScroll&&this.scrollIntoView(r,g)}exportImage(r,g,v){return t(this,void 0,void 0,(function*(){const b=this.canvasWrapper.querySelectorAll("canvas");if(!b.length)throw new Error("No waveform data");if("dataURL"===v){const v=Array.from(b).map((v=>v.toDataURL(r,g)));return Promise.resolve(v)}return Promise.all(Array.from(b).map((v=>new Promise(((b,y)=>{v.toBlob((r=>{r?b(r):y(new Error("Could not export image"))}),r,g)})))))}))}}h.MAX_CANVAS_WIDTH=4e3;class l extends e{constructor(){super(...arguments),this.unsubscribe=()=>{}}start(){this.unsubscribe=this.on("tick",(()=>{requestAnimationFrame((()=>{this.emit("tick")}))})),this.emit("tick")}stop(){this.unsubscribe()}destroy(){this.unsubscribe()}}class d extends e{constructor(r=new AudioContext){super(),this.bufferNode=null,this.autoplay=!1,this.playStartTime=0,this.playedDuration=0,this._muted=!1,this._playbackRate=1,this.buffer=null,this.currentSrc="",this.paused=!0,this.crossOrigin=null,this.seeking=!1,this.addEventListener=this.on,this.removeEventListener=this.un,this.audioContext=r,this.gainNode=this.audioContext.createGain(),this.gainNode.connect(this.audioContext.destination)}load(){return t(this,void 0,void 0,(function*(){}))}get src(){return this.currentSrc}set src(r){if(this.currentSrc=r,!r)return this.buffer=null,void this.emit("emptied");fetch(r).then((g=>{if(g.status>=400)throw new Error(`Failed to fetch ${r}: ${g.status} (${g.statusText})`);return g.arrayBuffer()})).then((g=>this.currentSrc!==r?null:this.audioContext.decodeAudioData(g))).then((g=>{this.currentSrc===r&&(this.buffer=g,this.emit("loadedmetadata"),this.emit("canplay"),this.autoplay&&this.play())}))}_play(){var r;if(!this.paused)return;this.paused=!1,null===(r=this.bufferNode)||void 0===r||r.disconnect(),this.bufferNode=this.audioContext.createBufferSource(),this.bufferNode.buffer=this.buffer,this.bufferNode.playbackRate.value=this._playbackRate,this.bufferNode.connect(this.gainNode);let g=this.playedDuration*this._playbackRate;g>=this.duration&&(g=0,this.playedDuration=0),this.bufferNode.start(this.audioContext.currentTime,g),this.playStartTime=this.audioContext.currentTime,this.bufferNode.onended=()=>{this.currentTime>=this.duration&&(this.pause(),this.emit("ended"))}}_pause(){var r;this.paused=!0,null===(r=this.bufferNode)||void 0===r||r.stop(),this.playedDuration+=this.audioContext.currentTime-this.playStartTime}play(){return t(this,void 0,void 0,(function*(){this.paused&&(this._play(),this.emit("play"))}))}pause(){this.paused||(this._pause(),this.emit("pause"))}stopAt(r){var g,v;const b=r-this.currentTime;null===(g=this.bufferNode)||void 0===g||g.stop(this.audioContext.currentTime+b),null===(v=this.bufferNode)||void 0===v||v.addEventListener("ended",(()=>{this.bufferNode=null,this.pause()}),{once:!0})}setSinkId(r){return t(this,void 0,void 0,(function*(){return this.audioContext.setSinkId(r)}))}get playbackRate(){return this._playbackRate}set playbackRate(r){this._playbackRate=r,this.bufferNode&&(this.bufferNode.playbackRate.value=r)}get currentTime(){return(this.paused?this.playedDuration:this.playedDuration+(this.audioContext.currentTime-this.playStartTime))*this._playbackRate}set currentTime(r){this.emit("seeking");const g=!this.paused;g&&this._pause(),this.playedDuration=r/this._playbackRate,g&&this._play(),this.emit("timeupdate")}get duration(){var r;return(null===(r=this.buffer)||void 0===r?void 0:r.duration)||0}get volume(){return this.gainNode.gain.value}set volume(r){this.gainNode.gain.value=r,this.emit("volumechange")}get muted(){return this._muted}set muted(r){this._muted!==r&&(this._muted=r,this._muted?this.gainNode.disconnect():this.gainNode.connect(this.audioContext.destination))}canPlayType(r){return/^(audio|video)\//.test(r)}getGainNode(){return this.gainNode}getChannelData(){const r=[];if(!this.buffer)return r;const g=this.buffer.numberOfChannels;for(let v=0;v<g;v++)r.push(this.buffer.getChannelData(v));return r}}const b={waveColor:"#999",progressColor:"#555",cursorWidth:1,minPxPerSec:0,fillParent:!0,interact:!0,dragToSeek:!1,autoScroll:!0,autoCenter:!0,sampleRate:8e3};class u extends a{static create(r){return new u(r)}constructor(r){const g=r.media||("WebAudio"===r.backend?new d:void 0);super({media:g,mediaControls:r.mediaControls,autoplay:r.autoplay,playbackRate:r.audioRate}),this.plugins=[],this.decodedData=null,this.subscriptions=[],this.mediaSubscriptions=[],this.options=Object.assign({},b,r),this.timer=new l;const v=g?void 0:this.getMediaElement();this.renderer=new h(this.options,v),this.initPlayerEvents(),this.initRendererEvents(),this.initTimerEvents(),this.initPlugins(),Promise.resolve().then((()=>{this.emit("init");const r=this.options.url||this.getSrc()||"";(r||this.options.peaks&&this.options.duration)&&this.load(r,this.options.peaks,this.options.duration)}))}updateProgress(r=this.getCurrentTime()){return this.renderer.renderProgress(r/this.getDuration(),this.isPlaying()),r}initTimerEvents(){this.subscriptions.push(this.timer.on("tick",(()=>{if(!this.isSeeking()){const r=this.updateProgress();this.emit("timeupdate",r),this.emit("audioprocess",r)}})))}initPlayerEvents(){this.isPlaying()&&(this.emit("play"),this.timer.start()),this.mediaSubscriptions.push(this.onMediaEvent("timeupdate",(()=>{const r=this.updateProgress();this.emit("timeupdate",r)})),this.onMediaEvent("play",(()=>{this.emit("play"),this.timer.start()})),this.onMediaEvent("pause",(()=>{this.emit("pause"),this.timer.stop()})),this.onMediaEvent("emptied",(()=>{this.timer.stop()})),this.onMediaEvent("ended",(()=>{this.emit("finish")})),this.onMediaEvent("seeking",(()=>{this.emit("seeking",this.getCurrentTime())})))}initRendererEvents(){this.subscriptions.push(this.renderer.on("click",((r,g)=>{this.options.interact&&(this.seekTo(r),this.emit("interaction",r*this.getDuration()),this.emit("click",r,g))})),this.renderer.on("dblclick",((r,g)=>{this.emit("dblclick",r,g)})),this.renderer.on("scroll",((r,g)=>{const v=this.getDuration();this.emit("scroll",r*v,g*v)})),this.renderer.on("render",(()=>{this.emit("redraw")})),this.renderer.on("rendered",(()=>{this.emit("redrawcomplete")})));{let r;this.subscriptions.push(this.renderer.on("drag",(g=>{this.options.interact&&(this.renderer.renderProgress(g),clearTimeout(r),r=setTimeout((()=>{this.seekTo(g)}),this.isPlaying()?0:200),this.emit("interaction",g*this.getDuration()),this.emit("drag",g))})))}}initPlugins(){var r;(null===(r=this.options.plugins)||void 0===r?void 0:r.length)&&this.options.plugins.forEach((r=>{this.registerPlugin(r)}))}unsubscribePlayerEvents(){this.mediaSubscriptions.forEach((r=>r())),this.mediaSubscriptions=[]}setOptions(r){this.options=Object.assign({},this.options,r),this.renderer.setOptions(this.options),r.audioRate&&this.setPlaybackRate(r.audioRate),null!=r.mediaControls&&(this.getMediaElement().controls=r.mediaControls)}registerPlugin(r){return r._init(this),this.plugins.push(r),this.subscriptions.push(r.once("destroy",(()=>{this.plugins=this.plugins.filter((g=>g!==r))}))),r}getWrapper(){return this.renderer.getWrapper()}getScroll(){return this.renderer.getScroll()}getActivePlugins(){return this.plugins}loadAudio(g,b,y,C){return t(this,void 0,void 0,(function*(){if(this.emit("load",g),!this.options.media&&this.isPlaying()&&this.pause(),this.decodedData=null,!b&&!y){const t=r=>this.emit("loading",r);b=yield v.fetchBlob(g,t,this.options.fetchParams)}this.setSrc(g,b);const w=C||this.getDuration()||(yield new Promise((r=>{this.onceMediaEvent("loadedmetadata",(()=>r(this.getDuration())))})));if(y)this.decodedData=r.createBuffer(y,w||0);else if(b){const g=yield b.arrayBuffer();this.decodedData=yield r.decode(g,this.options.sampleRate)}this.decodedData&&(this.emit("decode",this.getDuration()),this.renderer.render(this.decodedData)),this.emit("ready",this.getDuration())}))}load(r,g,v){return t(this,void 0,void 0,(function*(){yield this.loadAudio(r,void 0,g,v)}))}loadBlob(r,g,v){return t(this,void 0,void 0,(function*(){yield this.loadAudio("blob",r,g,v)}))}zoom(r){if(!this.decodedData)throw new Error("No audio loaded");this.renderer.zoom(r),this.emit("zoom",r)}getDecodedData(){return this.decodedData}exportPeaks({channels:r=2,maxLength:g=8e3,precision:v=1e4}={}){if(!this.decodedData)throw new Error("The audio has not been decoded yet");const b=Math.min(r,this.decodedData.numberOfChannels),y=[];for(let r=0;r<b;r++){const b=this.decodedData.getChannelData(r),C=[],w=Math.round(b.length/g);for(let r=0;r<g;r++){const g=b.slice(r*w,(r+1)*w);let y=0;for(let r=0;r<g.length;r++){const v=g[r];Math.abs(v)>Math.abs(y)&&(y=v)}C.push(Math.round(y*v)/v)}y.push(C)}return y}getDuration(){let r=super.getDuration()||0;return 0!==r&&r!==1/0||!this.decodedData||(r=this.decodedData.duration),r}toggleInteraction(r){this.options.interact=r}setTime(r){super.setTime(r),this.updateProgress(r)}seekTo(r){const g=this.getDuration()*r;this.setTime(g)}playPause(){return t(this,void 0,void 0,(function*(){return this.isPlaying()?this.pause():this.play()}))}stop(){this.pause(),this.setTime(0)}skip(r){this.setTime(this.getCurrentTime()+r)}empty(){this.load("",[[0]],.001)}setMediaElement(r){this.unsubscribePlayerEvents(),super.setMediaElement(r),this.initPlayerEvents()}exportImage(r="image/png",g=1,v="dataURL"){return t(this,void 0,void 0,(function*(){return this.renderer.exportImage(r,g,v)}))}destroy(){this.emit("destroy"),this.plugins.forEach((r=>r.destroy())),this.subscriptions.forEach((r=>r())),this.unsubscribePlayerEvents(),this.timer.destroy(),this.renderer.destroy(),super.destroy()}}u.BasePlugin=class extends e{constructor(r){super(),this.subscriptions=[],this.options=r}onInit(){}_init(r){this.wavesurfer=r,this.onInit()}destroy(){this.emit("destroy"),this.subscriptions.forEach((r=>r()))}},u.dom=g;export{u as default};

